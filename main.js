!function(){"use strict";var t=function(){function t(){this.currentState=null,this.map=new Map}return t.prototype.init=function(){this.currentState.onEnter()},t.prototype.config=function(t,n){this.currentState=n;for(var e=0;e<t.length;e++)this.map.set(t[e].name,t[e])},t.prototype.pushState=function(t){if(this.map.has(t)){var n=this.map.get(t);this.currentState.onEnd(),this.currentState=n,this.currentState.onEnter()}},t}(),n=new t,e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},e(t,n)};function o(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}function r(t,n,e,o){return new(e||(e=Promise))((function(r,i){function c(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,u)}a((o=o.apply(t,n||[])).next())}))}function i(t,n){var e,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(a){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(c=0)),c;)try{if(e=1,o&&(r=2&u[0]?o.return:u[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,u[1])).done)return r;switch(o=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return c.label++,{value:u[1],done:!1};case 5:c.label++,o=u[1],u=[0];continue;case 7:u=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){c=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){c.label=u[1];break}if(6===u[0]&&c.label<r[1]){c.label=r[1],r=u;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(u);break}r[2]&&c.ops.pop(),c.trys.pop();continue}u=n.call(t,c)}catch(t){u=[6,t],o=0}finally{e=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}}"function"==typeof SuppressedError&&SuppressedError;var c=function(){function t(){}return t.prototype.onEnter=function(){toast(this.name+" enter"),console.log(this.name+" enter")},t}(),u=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="init",n}return o(e,t),e.prototype.onEnd=function(){},e.prototype.onUpdate=function(){return r(this,void 0,void 0,(function(){var t,e,o,r,c;return i(this,(function(i){return(t=id("udh").minWidth(20)).exists()?(toast("发现福袋"),e=pickup(t).bounds(),o=e.height(),r=e.width(),c=function(t,n,e){var o=captureScreen(),r=images.read("./assets/".concat(t,".png"));sleep(1e3);var i=findImage(o,r,{threshold:.6,region:e});return sleep(1e3),i}("pk",0,[e.left,e.top,r,o]),click(c.x,c.y)&&n.pushState("claim")):(toast("当前没有福袋"),console.log("当前没有福袋"),sleep(6e4)),[2]}))}))},e.prototype.onEnter=function(){t.prototype.onEnter.call(this)},e}(c),a=new u,p=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="claim",n}return o(e,t),e.prototype.onEnd=function(){},e.prototype.onUpdate=function(){if(text("参与成功 等待开奖").exists()||text("活动已结束").exists())return toast("已参与 退出"),back(),void n.pushState("check");var t,e,o=(t=text("一键发表评论"),e=text("发送评论 参与抽奖"),t.exists()?t:e.exists()?e:text("what can i Say"));if(o.exists()){var r=pickup(o).center();console.log(r),click(r.x,r.y),sleep(1e3),n.pushState("check")}},e.prototype.onEnter=function(){t.prototype.onEnter.call(this)},e}(c);var s=new p,l=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="pay",n}return o(e,t),e.prototype.onEnd=function(){},e.prototype.onUpdate=function(){var t=text("提交订单");if(t.exists()){var e=pickup(t).center(),o=e.x,r=e.y;click(o,r),sleep(3e3),back(),sleep(3e3),n.pushState("init")}},e.prototype.onEnter=function(){t.prototype.onEnter.call(this)},e}(c),f=new l,h=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="check",n}return o(e,t),e.prototype.onEnd=function(){},e.prototype.onUpdate=function(){var t=text("我知道了"),e=text("立即购买");if(t.exists()){toast("没中奖");var o=pickup(t).center(),r=click(o.x,o.y);sleep(1e4),r&&n.pushState("init")}if(e.exists()){toast("中奖了");o=pickup(e).center();click(o.x,o.y),sleep(3e3),n.pushState("pay")}},e.prototype.onEnter=function(){t.prototype.onEnter.call(this)},e}(c),y=new h;!function(){for(requestScreenCapture()||(toast("请求截图失败"),exit()),n.config([a,s,f,y],a),n.init();;)sleep(2e3),n.currentState.onUpdate(),sleep(2e3)}()}();
