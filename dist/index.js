var e,t,n,s,i,r;e=new class{constructor(){this.currentState=null,this.map=new Map}init(){this.currentState.onEnter()}config(e,t){this.currentState=t;for(var n=0;n<e.length;n++)this.map.set(e[n].name,e[n])}pushState(e){if(this.map.has(e)){let t=this.map.get(e);this.currentState.onEnd(),this.currentState=t,this.currentState.onEnter()}}},t=class{onEnter(){toast(this.name+" enter"),console.log(this.name+" enter")}},n=new class extends t{onEnd(){}async onUpdate(){let t=id("udh").minWidth(20);if(t.exists()){toast("发现福袋");let n=pickup(t).bounds(),s=n.height(),i=n.width(),r=function(e,t=.6,n){let s=captureScreen(),i=images.read("./assets/pk.png");sleep(1e3);var r=findImage(s,i,{threshold:.6,region:n});return sleep(1e3),r}(0,255,[n.left,n.top,i,s]);click(r.x,r.y)&&e.pushState("claim")}else toast("当前没有福袋"),console.log("当前没有福袋"),sleep(6e4)}onEnter(){super.onEnter()}constructor(...e){super(...e),this.name="init"}},s=new class extends t{onEnd(){}onUpdate(){if(text("参与成功 等待开奖").exists()||text("活动已结束").exists()){toast("已参与 退出"),back(),e.pushState("check");return}let t=function(){let e=text("一键发表评论"),t=text("发送评论 参与抽奖");return e.exists()?e:t.exists()?t:text("what can i Say")}();if(t.exists()){let n=pickup(t).center();console.log(n),click(n.x,n.y),sleep(1e3),e.pushState("check")}}onEnter(){super.onEnter()}constructor(...e){super(...e),this.name="claim"}},i=new class extends t{onEnd(){}onUpdate(){let t=text("提交订单");if(t.exists()){let{x:n,y:s}=pickup(t).center();click(n,s),sleep(3e3),back(),sleep(3e3),e.pushState("init")}}onEnter(){super.onEnter()}constructor(...e){super(...e),this.name="pay"}},r=new class extends t{onEnd(){}onUpdate(){let t=text("我知道了"),n=text("立即购买");if(t.exists()){toast("没中奖");let n=pickup(t).center(),s=click(n.x,n.y);sleep(1e4),s&&e.pushState("init")}if(n.exists()){toast("中奖了");let t=pickup(n).center();click(t.x,t.y),sleep(3e3),e.pushState("pay")}}onEnter(){super.onEnter()}constructor(...e){super(...e),this.name="check"}},function(){for(requestScreenCapture()||(toast("请求截图失败"),exit()),e.config([n,s,i,r],n),e.init();;)sleep(2e3),e.currentState.onUpdate(),sleep(2e3)}();